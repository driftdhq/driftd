{{define "title"}}Dashboard{{end}}

{{define "content"}}
<h1>Repositories</h1>

{{if .ConfigRepos}}
<section class="repos">
    {{range .ConfigRepos}}
    <div class="repo-card">
        <div class="repo-header">
            {{$status := false}}
            {{range $.Repos}}
                {{if eq .Name $.Name}}
                    {{$status = .Drifted}}
                {{end}}
            {{end}}
            <span class="status-indicator {{if $status}}drifted{{else}}ok{{end}}"></span>
            <a href="/repos/{{.Name}}">{{.Name}}</a>
        </div>
        <div class="repo-meta">
            {{$stackCount := 0}}
            {{range $.Repos}}
                {{if eq .Name $.Name}}
                    {{$stackCount = .Stacks}}
                {{end}}
            {{end}}
            <span>{{$stackCount}} stacks discovered</span>
            {{range $.Repos}}
                {{if eq .Name $.Name}}
                    {{if .Active}}
                        <span class="meta-pill">Running {{.Progress}}</span>
                    {{else if not .LastRun.IsZero}}
                        <span class="meta-pill">Last run {{timeAgo .LastRun}}</span>
                    {{end}}
                    {{if .CommitSHA}}
                        <span class="meta-pill">Commit {{printf "%.7s" .CommitSHA}}</span>
                    {{end}}
                {{end}}
            {{end}}
        </div>
        <form method="POST" action="/repos/{{.Name}}/scan" class="scan-form">
            <button type="submit" class="btn btn-scan">Scan All</button>
        </form>
    </div>
    {{end}}
</section>
{{else}}
<p class="empty-state">No repositories configured. Add repos to your config file.</p>
{{end}}
{{end}}
