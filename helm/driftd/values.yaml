image:
  repository: ghcr.io/driftdhq/driftd
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8080

server:
  replicas: 1
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  envFrom: []
  extraEnv:
    - name: DRIFTD_DEFAULT_TERRAFORM_VERSION
      value: "1.14.4"
    - name: DRIFTD_DEFAULT_TERRAGRUNT_VERSION
      value: "0.99.1"
  # extraEnv:
  #   - name: LOG_LEVEL
  #     value: debug

worker:
  replicas: 2
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  envFrom: []
  extraEnv:
    - name: DRIFTD_DEFAULT_TERRAFORM_VERSION
      value: "1.14.4"
    - name: DRIFTD_DEFAULT_TERRAGRUNT_VERSION
      value: "0.99.1"
  # extraEnv:
  #   # Direct value
  #   - name: TF_VAR_region
  #     value: us-east-1
  #   # From secret
  #   - name: CLOUDFLARE_API_TOKEN
  #     valueFrom:
  #       secretKeyRef:
  #         name: provider-credentials
  #         key: cloudflare-api-token
  #   # From configmap
  #   - name: TF_CLI_CONFIG_FILE
  #     valueFrom:
  #       configMapKeyRef:
  #         name: terraform-config
  #         key: terraformrc

storage:
  data:
    enabled: true
    existingClaim: ""
    size: 20Gi
    accessModes: ["ReadWriteMany"]
    storageClassName: ""
  cache:
    enabled: true
    existingClaim: ""
    size: 20Gi
    accessModes: ["ReadWriteMany"]
    storageClassName: ""

config:
  data_dir: /data
  listen_addr: ":8080"
  redis:
    addr: "driftd-redis-master:6379"
    password: ""
    db: 0
  worker:
    concurrency: 5
    lock_ttl: 30m
    retry_once: true
    scan_max_age: 6h
    renew_every: 10s
  workspace:
    retention: 5
  repos: []

# Redis subchart configuration
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  image:
    registry: docker.io
    repository: bitnami/redis
    tag: latest
    digest: sha256:412da89feed59b1a45b0c1fd9d07cdb2e2283cf4db2e5a1604762ad03d53af6d  # Redis 8.4.0
  master:
    persistence:
      enabled: false
